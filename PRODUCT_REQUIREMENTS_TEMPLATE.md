# RST AI Core - 产品需求文档模板
# Product Requirements Document Template

**版本**: 1.0  
**创建日期**: 2024-10-13  
**模板类型**: 模块化功能需求  

---

## 📋 需求基本信息 (Basic Information)

### 🎯 需求概述
- **需求名称**: [功能名称，如：用户评论管理]
- **需求编号**: [REQ-YYYY-MMDD-XXX，如：REQ-2024-1013-001]
- **优先级**: [高/中/低]
- **预期上线时间**: [YYYY-MM-DD]
- **需求提出人**: [产品经理姓名]
- **开发负责人**: [开发工程师姓名]

### 📝 需求描述
```
[详细描述这个功能的业务背景、用户价值和解决的问题]

示例：
用户需要能够对商品进行评论和评分，其他用户可以查看这些评论来做购买决策。
管理员需要能够审核和管理不当评论。
```

---

## 🏗️ 模块设计信息 (Module Design)

### 📁 模块基本信息
- **模块名称**: [英文小写+下划线，如：user_comments]
- **模块显示名**: [中文名称]
- **模块描述**: [一句话描述模块功能]
- **模块类型**: [CRUDModule / BaseModule]

### 🔗 依赖关系
- **依赖模块**: [必填：core, 其他依赖模块列表]
- **提供功能**: [本模块对其他模块提供的功能]
- **外部依赖**: [第三方库或服务依赖]

---

## 🗃️ 数据模型设计 (Data Models)

### 📊 主要实体
```yaml
实体名称: [如：UserComment]
表名: [如：user_comments]
描述: [实体的业务含义]

字段设计:
  - 字段名: content
    类型: str
    长度: 1000
    必填: true
    描述: 评论内容
    
  - 字段名: rating
    类型: int
    范围: 1-5
    必填: true
    描述: 评分 1-5星
    
  - 字段名: status
    类型: str
    枚举: [pending, approved, rejected]
    默认: pending
    描述: 审核状态
    
  - 字段名: is_anonymous
    类型: bool
    默认: false
    描述: 是否匿名评论

关联关系:
  - 关联模型: User (core module)
    关系类型: 多对一
    外键字段: owner_id
    级联删除: true
    描述: 评论所属用户
    
  - 关联模型: Product (products module)  
    关系类型: 多对一
    外键字段: product_id
    级联删除: true
    描述: 评论的商品
```

### 📋 模型列表
- **基础模型**: [Entity]Base
- **数据库模型**: [Entity] (table=True)
- **创建模型**: [Entity]Create
- **更新模型**: [Entity]Update
- **公开模型**: [Entity]Public
- **列表模型**: [Entity]sPublic

---

## 🛣️ API端点设计 (API Endpoints)

### 🔧 标准CRUD端点
```yaml
基础路径: /api/v1/user-comments

端点列表:
  - 方法: POST
    路径: /
    功能: 创建评论
    权限: 登录用户
    
  - 方法: GET
    路径: /
    功能: 获取评论列表
    权限: 公开 (可查看已审核评论)
    参数: skip, limit, product_id, status
    
  - 方法: GET
    路径: /{id}
    功能: 获取单个评论
    权限: 评论作者或管理员
    
  - 方法: PUT
    路径: /{id}
    功能: 更新评论
    权限: 评论作者 (仅限pending状态)
    
  - 方法: DELETE
    路径: /{id}
    功能: 删除评论
    权限: 评论作者或管理员
```

### 🎯 自定义端点
```yaml
自定义功能:
  - 端点: GET /search
    功能: 搜索评论
    参数: q (搜索关键词), rating_min, rating_max
    权限: 公开
    
  - 端点: POST /{id}/approve
    功能: 审核通过评论
    权限: 管理员
    
  - 端点: POST /{id}/reject
    功能: 拒绝评论
    权限: 管理员
    
  - 端点: GET /stats
    功能: 获取评论统计信息
    权限: 管理员
    返回: 总数、各状态数量、平均评分等
```

---

## 👥 用户角色和权限 (User Roles & Permissions)

### 🔐 权限矩阵
```yaml
角色权限设计:
  普通用户:
    - 创建评论: ✅ (对购买的商品)
    - 查看评论: ✅ (已审核的公开评论)
    - 修改自己的评论: ✅ (仅pending状态)
    - 删除自己的评论: ✅
    
  管理员:
    - 查看所有评论: ✅
    - 审核评论: ✅
    - 删除任意评论: ✅
    - 查看统计信息: ✅
    
  游客:
    - 查看评论: ✅ (已审核的公开评论)
```

### 🛡️ 安全要求
- 敏感信息保护: [不返回用户私人信息]
- 输入验证: [评论内容长度、评分范围验证]
- 防刷机制: [同一用户对同一商品限制评论频次]
- 内容审核: [敏感词过滤、垃圾评论检测]

---

## 🎨 业务逻辑规则 (Business Logic)

### 📋 业务规则
```yaml
核心业务规则:
  1. 评论创建规则:
     - 用户必须登录
     - 用户必须购买过该商品 (可选)
     - 同一商品每个用户只能评论一次
     - 评论内容不能为空，长度限制1000字符
     - 评分必须在1-5之间
     
  2. 审核规则:
     - 新评论默认pending状态
     - 管理员可以approve或reject
     - 只有approved状态的评论对公众可见
     - rejected评论保留但不显示
     
  3. 修改规则:
     - 用户只能修改pending状态的评论
     - 已审核的评论不允许修改
     - 修改后评论状态重置为pending
     
  4. 删除规则:
     - 用户可以删除自己的评论
     - 管理员可以删除任意评论
     - 删除采用软删除机制
```

### 🔄 状态流转
```yaml
状态流转图:
  pending -> approved (管理员审核通过)
  pending -> rejected (管理员拒绝)
  approved -> rejected (管理员后续拒绝)
  rejected -> approved (管理员重新审核)
  
  不允许的流转:
  - approved -> pending
  - 用户不能直接设置approved状态
```

---

## 🧪 测试场景设计 (Test Scenarios)

### ✅ 功能测试用例
```yaml
必需测试用例:
  1. 创建评论测试:
     - 正常创建评论
     - 未登录用户创建评论 (应失败)
     - 重复评论同一商品 (应失败)
     - 评论内容为空 (应失败)
     - 评分超出范围 (应失败)
     
  2. 查询评论测试:
     - 获取评论列表
     - 按商品ID筛选评论
     - 按状态筛选评论 (管理员)
     - 分页查询测试
     - 获取不存在的评论 (404)
     
  3. 更新评论测试:
     - 用户更新自己的pending评论
     - 用户更新已审核评论 (应失败)
     - 用户更新他人评论 (应失败)
     - 管理员审核评论
     
  4. 删除评论测试:
     - 用户删除自己的评论
     - 用户删除他人评论 (应失败)
     - 管理员删除任意评论
     - 删除不存在的评论 (404)
     
  5. 权限测试:
     - 游客访问限制测试
     - 普通用户权限边界测试
     - 管理员权限测试
     
  6. 业务规则测试:
     - 状态流转测试
     - 数据验证测试
     - 并发操作测试
```

### 🚀 性能测试要求
- **响应时间**: 95%请求 < 200ms
- **并发量**: 支持100个并发用户
- **数据量**: 支持10万条评论数据

---

## 📊 数据统计需求 (Analytics Requirements)

### 📈 统计指标
```yaml
需要的统计数据:
  管理员统计:
    - 总评论数
    - 各状态评论数量
    - 每日新增评论数
    - 平均评分
    - 评论通过率
    - 活跃评论用户数
    
  商品评论统计:
    - 单个商品评论数
    - 单个商品平均评分
    - 评分分布情况
    
  用户评论统计:
    - 用户总评论数
    - 用户平均评分倾向
```

---

## 🔧 配置选项 (Configuration Options)

### ⚙️ 模块配置
```yaml
配置参数:
  max_comments_per_user: 1000        # 单用户最大评论数
  max_comment_length: 1000           # 评论最大长度
  enable_anonymous_comments: false   # 是否允许匿名评论
  auto_approve_trusted_users: false  # 信任用户评论自动审核
  comment_cooldown_minutes: 60       # 评论冷却时间(分钟)
  enable_rating_required: true       # 是否必须提供评分
  min_rating: 1                      # 最小评分
  max_rating: 5                      # 最大评分
```

---

## 📱 前端界面需求 (Frontend Requirements)

### 🎨 界面组件需求
```yaml
需要的前端组件:
  评论列表页面:
    - 评论列表显示
    - 按评分筛选
    - 按时间排序
    - 分页组件
    
  评论详情页面:
    - 评论内容展示
    - 用户信息显示
    - 点赞/有用功能 (可选)
    
  评论编写页面:
    - 评分选择器 (星级)
    - 评论内容输入框
    - 匿名选项 (如启用)
    - 提交/取消按钮
    
  管理员界面:
    - 待审核评论列表
    - 批量审核功能
    - 评论统计图表
    - 敏感词管理
```

---

## 📋 验收标准 (Acceptance Criteria)

### ✅ 功能验收标准
```yaml
验收条件:
  基础功能:
    - ✅ 用户可以成功创建评论
    - ✅ 评论列表正确显示已审核评论
    - ✅ 管理员可以审核评论
    - ✅ 权限控制正确实施
    - ✅ 所有API端点返回正确格式数据
    
  数据完整性:
    - ✅ 数据库约束正确设置
    - ✅ 外键关系正确建立
    - ✅ 数据验证规则生效
    
  性能要求:
    - ✅ API响应时间满足要求
    - ✅ 数据库查询优化
    - ✅ 分页功能正常
    
  测试覆盖:
    - ✅ 单元测试覆盖率 >= 80%
    - ✅ 所有API端点有集成测试
    - ✅ 权限测试完整
    
  文档完整:
    - ✅ API文档完整
    - ✅ 模块使用说明清晰
    - ✅ 数据库设计文档
```

---

## 📝 补充说明 (Additional Notes)

### 💡 实现建议
```yaml
开发建议:
  技术选择:
    - 使用CRUDModule基类快速实现标准CRUD
    - 评论内容使用TEXT类型存储
    - 评分使用整数类型，前端转换为星级显示
    
  性能优化:
    - 为product_id和owner_id创建索引
    - 考虑评论缓存机制
    - 已审核评论列表使用缓存
    
  扩展性考虑:
    - 预留评论回复功能接口
    - 预留图片附件功能
    - 预留评论投票功能
```

### 🚨 风险和限制
```yaml
风险评估:
  技术风险:
    - 大量评论可能影响查询性能
    - 敏感词过滤可能不够准确
    
  业务风险:
    - 恶意评论可能影响商品声誉
    - 刷评论行为需要防范
    
  时间风险:
    - 审核机制开发复杂度较高
    - 前后端联调时间可能较长
    
  解决方案:
    - 实施分页和索引优化
    - 建立完善的内容审核机制
    - 制定详细的开发计划和里程碑
```

---

## 📞 联系信息 (Contact Information)

- **产品负责人**: [姓名] - [邮箱] - [电话]
- **技术负责人**: [姓名] - [邮箱] - [电话]
- **测试负责人**: [姓名] - [邮箱] - [电话]
- **UI设计师**: [姓名] - [邮箱] - [电话]

---

**文档状态**: 待评审  
**下次审核时间**: [YYYY-MM-DD]  
**文档修订历史**: 
- v1.0 - 2024-10-13 - 初始版本创建

---

*本文档基于 RST AI Core 模块开发规范创建*  
*文档模板版本: 1.0*
